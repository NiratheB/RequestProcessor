# RequestProcessor

## Problem Statement
Write an HTTP service that
- receives requests generated by our collector
- check the validity of each request
- reject invalid requests
  - malformed JSON <br>
  - missing one or more fields <br>
  - with a customer ID not found in the database or for a customer which is disabled <br>
  - with a remote IP address which is in the blacklist <br>
  - with a user agent which is in the blacklist <br>
- count and store statistics per customer per hour <br>
  - an endpoint to get the statistics <br>
    - for a specific customer  <br>
      AND <br>
    - a specific day<br>

  The response must also contain the total number of requests for that day.
    
## Solution
The solution is implemented using Django and MySQL.
### Features:
  - ```POST /request/``` : Validates the request and updates the statistics table
  - ```GET /stat/?id=<customer_id>&date=<dd/mm/yyyy>``` : Returns Statistics of the customer at the specified date in the form of JSON.
     - e.g.
     ```json
       {
        "total_requests_on_date": 11,
        "total_requests_by_customer": {
            "valid": 5,
            "invalid": 6
        },
        "stat_by_hour": [
            {
                "hour": 2,
                "request_count": 5,
                "invalid_count": 6
            }
        ]
      } 
    ```

## How to run
### Setup
- Prequisites:
  - Docker
  - docker-compose
- Clone the repository and cd.
- Build the Dockerfile
  ```bash
  docker build .
  ```
  *Might need to sudo if you get permision error*
 - Build the images
 ```bash
 docker-compose build
 ```
 - Migrate the database
 ```bash
 docker-compose run web python manage.py migrate
 ```
 ### Usage
 - Send ```POST``` request to ```0.0.0.0:8000/request/``` with json
 e.g. 
 ```
 POST /request/ HTTP/1.1
 Host: 0.0.0.0:8000
 
 {"customerID":1,"tagID":2,"userID":"aaaaaaaa-bbbb-cccc-1111-222222222222","remoteIP":"123.234.56.78","timestamp":1500000000}
 ```
 
 - Send ```GET``` request to ```0.0.0.0:8000/stat/?id=<customer_id>&date=<dd/mm/yyyy>``` to get statistics
 
 
 ## References:
  - Docker : https://docker-curriculum.com/
  - Django : https://docs.djangoproject.com/en/3.0/
 
 

